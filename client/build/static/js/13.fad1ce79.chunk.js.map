{"version":3,"sources":["state/products/actions.js","components/cart/Checkout.js"],"names":["getProducts","page","url","dispatch","a","type","query","axios","get","data","payload","products","pagination","count","console","log","response","error","message","getSingle","id","getCart","addToCart","item","post","cart","setAxiosToken","removeItem","itemid","put","reduceItem","addItem","clearCart","toastSettings","position","toast","POSITION","BOTTOM_RIGHT","CheckoutForm","injectStripe","stripe","user","history","useState","charging","setCharging","completed","setCompleted","submit","e","preventDefault","createToken","name","email","token","Error","stripeToken","success","setTimeout","push","hasOwnProperty","handleChange","onSubmit","className","createStyle","onChange","style","base","fontSize","color","fontFamily","letterSpacing","invalid","connect","state","auth","setRedirection","useEffect","apiKey","autoClose","pauseOnFocusLoss"],"mappings":"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","file":"static/js/13.fad1ce79.chunk.js","sourcesContent":["import axios from 'axios';\r\nimport setAxiosToken from '../../utils/setAxiosToken';\r\n\r\nexport const getProducts = (\r\n\tpage = 1,\r\n\turl = '/api/v1/products?limit=6&'\r\n) => async dispatch => {\r\n\tdispatch({ type: 'PRODUCTS_LOADING' });\r\n\r\n\tlet query = url + `&page=${page}&select=name,price,discountPrice,id,photo_id`;\r\n\r\n\ttry {\r\n\t\tconst { data } = await axios.get(query);\r\n\r\n\t\tdispatch({\r\n\t\t\ttype: 'GET_PRODUCTS',\r\n\t\t\tpayload: {\r\n\t\t\t\tproducts: data.data,\r\n\t\t\t\tpagination: data.pagination,\r\n\t\t\t\tcount: data.count,\r\n\t\t\t\turl\r\n\t\t\t}\r\n\t\t});\r\n\t} catch (err) {\r\n\t\tconsole.log(err.response ? err.response.data.error : err.message);\r\n\t\tdispatch({\r\n\t\t\ttype: 'PRODUCTS_ERROR',\r\n\t\t\tpayload: err.response ? err.response.data.error : err.message\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport const getSingle = id => async dispatch => {\r\n\tdispatch({ type: 'PRODUCTS_LOADING' });\r\n\ttry {\r\n\t\tconst { data } = await axios.get(`/api/v1/products/${id}`);\r\n\r\n\t\tdispatch({ type: 'CURRENT_PRODUCT', payload: data.data });\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\tdispatch({\r\n\t\t\ttype: 'PRODUCTS_ERROR',\r\n\t\t\tpayload: err.response ? err.response.data.error : err.message\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport const getCart = () => async dispatch => {\r\n\ttry {\r\n\t\tconst { data } = await axios.get('/api/v1/cart');\r\n\t\tdispatch({ type: 'GET_CART', payload: data.data });\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\tdispatch({\r\n\t\t\ttype: 'PRODUCTS_ERROR',\r\n\t\t\tpayload: err.response ? err.response.data.error : err.message\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport const addToCart = item => async dispatch => {\r\n\ttry {\r\n\t\tconst { data } = await axios.post('/api/v1/cart', item);\r\n\t\tdispatch({ type: 'SET_CART_TOKEN', payload: data.cart });\r\n\t\tsetAxiosToken();\r\n\t\treturn false;\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\tdispatch({\r\n\t\t\ttype: 'PRODUCTS_ERROR',\r\n\t\t\tpayload: err.response ? err.response.data.error : err.message\r\n\t\t});\r\n\t\treturn err.response ? err.response.data.error : err.message;\r\n\t}\r\n};\r\n\r\nexport const removeItem = itemid => async dispatch => {\r\n\ttry {\r\n\t\tconst { data } = await axios.put(`/api/v1/cart/remove/${itemid}`);\r\n\t\tdispatch({ type: 'SET_CART_TOKEN', payload: data.cart });\r\n\t\tsetAxiosToken();\r\n\t\tdispatch(getCart());\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\tdispatch({\r\n\t\t\ttype: 'PRODUCTS_ERROR',\r\n\t\t\tpayload: err.response ? err.response.data.error : err.message\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport const reduceItem = itemid => async dispatch => {\r\n\ttry {\r\n\t\tconst { data } = await axios.put(`/api/v1/cart/reduce/${itemid}`);\r\n\t\tdispatch({ type: 'SET_CART_TOKEN', payload: data.cart });\r\n\t\tsetAxiosToken();\r\n\t\tdispatch(getCart());\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\tdispatch({\r\n\t\t\ttype: 'PRODUCTS_ERROR',\r\n\t\t\tpayload: err.response ? err.response.data.error : err.message\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport const addItem = itemid => async dispatch => {\r\n\ttry {\r\n\t\tconst { data } = await axios.put(`/api/v1/cart/add/${itemid}`);\r\n\t\tdispatch({ type: 'SET_CART_TOKEN', payload: data.cart });\r\n\t\tsetAxiosToken();\r\n\t\tdispatch(getCart());\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\tdispatch({\r\n\t\t\ttype: 'PRODUCTS_ERROR',\r\n\t\t\tpayload: err.response ? err.response.data.error : err.message\r\n\t\t});\r\n\t}\r\n};\r\n\r\nexport const clearCart = () => ({\r\n\ttype: 'CLEAR_CART'\r\n});\r\n","import React, { useEffect, useState } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { setRedirection } from '../../state/auth/actions';\r\nimport { clearCart } from '../../state/products/actions';\r\nimport axios from 'axios';\r\nimport {\r\n\tCardNumberElement,\r\n\tCardExpiryElement,\r\n\tCardCVCElement,\r\n\tinjectStripe,\r\n\tStripeProvider,\r\n\tElements\r\n} from 'react-stripe-elements';\r\n\r\nimport { ToastContainer, toast } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\n\r\nconst toastSettings = {\r\n\tposition: toast.POSITION.BOTTOM_RIGHT\r\n};\r\n\r\nconst CheckoutForm = injectStripe(({ stripe, user, history, clearCart }) => {\r\n\tconst [charging, setCharging] = useState(false);\r\n\tconst [completed, setCompleted] = useState(false);\r\n\r\n\tconst submit = async e => {\r\n\t\te.preventDefault();\r\n\r\n\t\tif (!charging && !completed) {\r\n\t\t\ttry {\r\n\t\t\t\tsetCharging(true);\r\n\r\n\t\t\t\tconst { token } = await stripe.createToken({\r\n\t\t\t\t\tname: user.name,\r\n\t\t\t\t\temail: user.email\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (!token) {\r\n\t\t\t\t\tthrow new Error('Please set valid fields');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst { data } = await axios.post('/api/v1/checkout/stripe', {\r\n\t\t\t\t\tstripeToken: token.id\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsetCompleted(true);\r\n\t\t\t\ttoast.success('Purchase completed!', toastSettings);\r\n\t\t\t\tsetCharging(false);\r\n\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tclearCart();\r\n\t\t\t\t\thistory.push(`/myaccount/order/${data.data.id}`);\r\n\t\t\t\t}, 3000);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t\tif (err.hasOwnProperty('response')) {\r\n\t\t\t\t\treturn toast.error(err.response.data.error, toastSettings);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttoast.error(err.message, toastSettings);\r\n\t\t\t\tsetCharging(false);\r\n\t\t\t\tsetCompleted(false);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleChange = ({ error }) => {\r\n\t\tif (error) {\r\n\t\t\ttoast.error(error.message, toastSettings);\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<form onSubmit={submit}>\r\n\t\t\t<div className='form-item'>\r\n\t\t\t\tCard Number\r\n\t\t\t\t<CardNumberElement\r\n\t\t\t\t\t{...createStyle()}\r\n\t\t\t\t\tonChange={handleChange}\r\n\t\t\t\t\tclassName='form-item-input'\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<div className='form-item'>\r\n\t\t\t\tExpiration date\r\n\t\t\t\t<CardExpiryElement\r\n\t\t\t\t\t{...createStyle()}\r\n\t\t\t\t\tonChange={handleChange}\r\n\t\t\t\t\tclassName='form-control'\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<div className='form-item'>\r\n\t\t\t\tCVC\r\n\t\t\t\t<CardCVCElement\r\n\t\t\t\t\t{...createStyle()}\r\n\t\t\t\t\tonChange={handleChange}\r\n\t\t\t\t\tclassName='form-control'\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<button className='checkout-btn'>{charging ? 'Loading' : 'Pay'}</button>\r\n\t\t</form>\r\n\t);\r\n});\r\n\r\nconst Checkout = ({ user, history, setRedirection, cart, clearCart }) => {\r\n\tuseEffect(() => {\r\n\t\tif (!user) {\r\n\t\t\tsetRedirection('/checkout');\r\n\t\t\thistory.push('/login');\r\n\t\t}\r\n\r\n\t\tif (!cart) {\r\n\t\t\thistory.push('/cart');\r\n\t\t}\r\n\t});\r\n\r\n\treturn (\r\n\t\t<StripeProvider apiKey='pk_test_EXqLc8FY8HP36XX3Hl9Ud3iA001BFv7c2j'>\r\n\t\t\t<section className='checkout'>\r\n\t\t\t\t<div className='container'>\r\n\t\t\t\t\t<h2>Checkout</h2>\r\n\t\t\t\t\t<Elements>\r\n\t\t\t\t\t\t<CheckoutForm user={user} history={history} clearCart={clearCart} />\r\n\t\t\t\t\t</Elements>\r\n\t\t\t\t</div>\r\n\t\t\t\t<ToastContainer autoClose={2000} pauseOnFocusLoss={false} />\r\n\t\t\t</section>\r\n\t\t</StripeProvider>\r\n\t);\r\n};\r\n\r\nconst createStyle = () => {\r\n\treturn {\r\n\t\tstyle: {\r\n\t\t\tbase: {\r\n\t\t\t\tfontSize: '16px',\r\n\t\t\t\tcolor: '#424770',\r\n\t\t\t\tfontFamily: 'Open Sans, sans-serif',\r\n\t\t\t\tletterSpacing: '0.025em',\r\n\t\t\t\t'::placeholder': {\r\n\t\t\t\t\tcolor: '#aab7c4'\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tinvalid: {\r\n\t\t\t\tcolor: '#c23d4b'\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n\r\nconst mapStateToProps = state => ({\r\n\tuser: state.auth.user,\r\n\tcart: state.products.cart\r\n});\r\n\r\nexport default connect(mapStateToProps, { setRedirection, clearCart })(\r\n\tCheckout\r\n);\r\n"],"sourceRoot":""}